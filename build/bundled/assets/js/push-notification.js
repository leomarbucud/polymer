'use strict';const applicationServerPublicKey='BPKBg4mOubuUYHZDnEEAAaekOOCK85_SksGDTF3w6PL1Ljz6XhbOLQrHh9tzhkG3gvPbwIDnrm0Lx6vDK8iOg6E',pushButton=document.querySelector('.js-push-btn');let isSubscribed=!1,swRegistration=null;function urlB64ToUint8Array(a){const b='='.repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,'+').replace(/_/g,'/'),d=window.atob(c),e=new Uint8Array(d.length);for(let b=0;b<d.length;++b)e[b]=d.charCodeAt(b);return e}function initialiseUI(){pushButton.addEventListener('click',function(){pushButton.disabled=!0,isSubscribed?unsubscribeUser():subscribeUser()}),swRegistration.pushManager.getSubscription().then(function(a){isSubscribed=null!==a,updateSubscriptionOnServer(a),isSubscribed?console.log('User IS subscribed.'):console.log('User is NOT subscribed.'),updateBtn()})}function updateBtn(){return'denied'===Notification.permission?(pushButton.textContent='Push Messaging Blocked.',pushButton.disabled=!0,void updateSubscriptionOnServer(null)):void(pushButton.textContent=isSubscribed?'Disable Push Messaging':'Enable Push Messaging',pushButton.disabled=!1)}navigator.serviceWorker.register('service-worker.js').then(function(a){console.log('Service Worker is registered',a),swRegistration=a,initialiseUI()});function subscribeUser(){const a=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a}).then(function(a){console.log('User is subscribed.'),updateSubscriptionOnServer(a),isSubscribed=!0,updateBtn()}).catch(function(a){console.log('Failed to subscribe the user: ',a),updateBtn()})}function updateSubscriptionOnServer(a){const b=document.querySelector('.js-subscription-json'),c=document.querySelector('.js-subscription-details');a?(b.textContent=JSON.stringify(a),c.classList.remove('is-invisible')):c.classList.add('is-invisible')}function unsubscribeUser(){swRegistration.pushManager.getSubscription().then(function(a){if(a)return a.unsubscribe()}).catch(function(a){console.log('Error unsubscribing',a)}).then(function(){updateSubscriptionOnServer(null),console.log('User is unsubscribed.'),isSubscribed=!1,updateBtn()})}