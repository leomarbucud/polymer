<html><head></head><body><dom-module id="grid-profile-edit"><template><style include="grid iron-flex">:host{display:block;height:100%;background:var(--dark-red);}.profile-image{width:100%;height:200px;position:relative;}.image-container{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;}.profile-image img{border-radius:50%;width:200px;height:200px;}.image-select{position:absolute;bottom:0;right:0;height:50px;width:50px;background:#FFFFFF;border-radius:50%;display:flex;align-items:center;justify-content:center;}</style><div id="toolbar" class="toolbar dred-bg"><paper-icon-button icon="chevron-left" class="white pointer" on-click="redirectProfile"></paper-icon-button><span class="flex"></span><paper-button on-click="upload" class="white" hidden$="[[!selectedAvatar]]">Submit</paper-button></div><main class="p-y-1"><div class="profile-image"><div class="image-container"><div class="relative"><img id="avatar" src="[[currentAvatar]]"> <span class="image-select"><paper-icon-button icon="image:camera-alt" on-click="selectFile"></paper-icon-button></span></div></div></div><div class="img-edit"></div><a id="export" data-download="awesome-avatar.png"><img> </a><input type="file" id="file" on-change="previewAvatar" style="position: absolute; left: -99999px; top: -99999px"></main><template is="dom-if" if="[[isLoading]]"><div class="overlay dred-bg"><div class="align-center"><paper-spinner active$="[[isLoading]]"></paper-spinner></div></div></template></template><script>class GridProfileEdit extends GridNavigation(ReduxAsyncActionBehavior(ReduxBehavior(Polymer.Element))){static get is(){return'grid-profile-edit'}static get properties(){return{user:{type:Object,statePath:'user'}}}static get observers(){return[]}static get actions(){return{}}constructor(){super(),this.selectedAvatar=null,this.isLoading=!1}connectedCallback(){super.connectedCallback(),this.currentAvatar=this.user.profile?this._profileImage(this.user.profile.profile_image_url):this._profileImage(null)}upload(){if(this.user&&this.selectedAvatar){this.isLoading=!0;let a=new FormData;a.append('avatar',this.selectedAvatar),gAxios.post(`/users/${this.user.id}/upload`,a).then((a)=>{console.log(a.data),this.selectedAvatar=null,this.dispatch('updateUser',a.data),this.isLoading=!1})}}selectFile(){this.shadowRoot.querySelector('#file').click()}previewAvatar(){const a=this.shadowRoot.querySelector('#file').files[0];let b=[],c=!1;switch(a.type){case'image/jpeg':case'image/png':c=!0;}if(c?1e6>=a.size||b.push(`${a.name} is greater than 1mb.`):b.push(`${a.name} is not valid to upload.`),b.length)alert(b.join('\n')),this.shadowRoot.querySelector('#avatar').src=this.currentAvatar;else{let b=new FileReader;b.onloadend=()=>{this.shadowRoot.querySelector('#avatar').src=b.result,this.selectedAvatar=a},a?b.readAsDataURL(a):this.shadowRoot.querySelector('#avatar').src=this.currentAvatar}}loadAvatarCrop(a,b){let c=document.createElement('script');c.type='text/javascript',c.onerror=this.googleApiError,b&&(c.onload=b);let d=document.getElementsByTagName('head')[0];d.appendChild(c),c.src=a}_profileImage(a){return this.user?a?-1==a.indexOf('data:image')?this.url.API_BASE_URL+'/uploads/'+a:a:LetterAvatar(this.user.name,'200'):void 0}}customElements.define(GridProfileEdit.is,GridProfileEdit);</script></dom-module></body></html>