<html><head></head><body><div hidden="" by-polymer-bundler=""><link rel="import" href="bids/grid-bid.html"></div><dom-module id="grid-bids"><template><style include="grid grid-cards iron-flex">:host{display:block;position:relative;height:100%;background:var(--light-grey);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;}.title h1{font-weight:400;font-size:32px;}.row{color:#FFFFFF;padding:8px 16px;position:relative;cursor:pointer;}.row .job-title{line-height:24px;font-size:18px;}.row [secondary]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.7;}.divider{padding:0 16px;}.divider hr{margin:0;opacity:0.12;}</style><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/bids" data="{{routeData}}" tail="{{subroute}}"></app-route><app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}"></app-route><app-route route="{{route}}" pattern="/bids/:id" data="{{bid}}"></app-route><div id="toolbar" class="toolbar"><paper-icon-button icon="first-page" class="red pointer" on-click="redirectHome"></paper-icon-button><div class="flex" style="overflow: hidden"><span id="toolbar-title">Bids</span></div><paper-icon-button icon="search" class="red pointer" on-click="openSearchBar"></paper-icon-button><paper-menu-button horizontal-align="right" vertical-align="top" ignore-select="true"><paper-icon-button icon="more-vert" slot="dropdown-trigger" class="red"></paper-icon-button><div slot="dropdown-content" class="dropdown-menu"><div class="item" on-click="refreshBids"><span>Refresh</span><paper-ripple></paper-ripple></div><div class="item-title"><span>Show only</span></div><div class="item"><paper-checkbox value="1" on-change="filterCheck">Awarded</paper-checkbox></div><div class="item"><paper-checkbox value="2" on-change="filterCheck">In progress</paper-checkbox></div><div class="item"><paper-checkbox value="3" on-change="filterCheck">Review</paper-checkbox></div><div class="item"><paper-checkbox value="4" on-change="filterCheck">Completed</paper-checkbox></div></div></paper-menu-button></div><div class="top-search-bar"><div class="toolbar"><div class="input-group suffix prefix"><div class="addon-prefix has-button"><paper-icon-button icon="chevron-left" class="pointer" on-click="closeSearchBar"></paper-icon-button></div><input type="text" class="input" value="{{search::input}}" placeholder="Search..."><div class="addon-suffix has-button"><paper-icon-button icon="close" class="pointer" on-click="clearSearchBar"></paper-icon-button></div></div></div></div><main class="flex relative"><section class="p-y-1 title"><h1 id="main-title" class="white m-0">Bids</h1></section><div id="post-list" class="white p-y-1" role="listbox"><template is="dom-repeat" items="[[ bids ]]" as="bid" filter="{{ _filterBids(query) }}"><template is="dom-if" if="[[bid.job]]"><paper-card class="card-list" id$="[[ bid.job.id ]]"><div class="layout horizontal w-100"><div class="card-content" on-click="viewBid"><div class="header-date">[[ _getStatus(bid) ]]</div><div class="header-title">[[ bid.job.name ]]</div><div class="description">[[ bid.job.details ]]</div></div><paper-menu-button horizontal-align="right" vertical-align="top"><paper-icon-button icon="more-vert" slot="dropdown-trigger"></paper-icon-button><paper-listbox slot="dropdown-content" class="dropdown-menu"><template is="dom-if" if="[[ !_isUserAccepted(bid.status) ]]"><paper-item class="item" on-click="openRemoveBidDialog"><span>Remove</span></paper-item></template><template is="dom-if" if="[[ _isUserAccepted(bid.status) ]]"><template is="dom-if" if="[[ bid.job.is_accepted ]]"><template is="dom-if" if="[[ !bid.job.is_completed ]]"><paper-item class="item" on-click="openDeletePostDialog"><span>Terminate</span></paper-item></template></template><template is="dom-if" if="[[ bid.job.is_completed ]]"><paper-item class="item" on-click="openHighlightDialog"><span>Highlight</span></paper-item></template></template></paper-listbox></paper-menu-button></div></paper-card></template></template><template is="dom-if" if="[[ !bids.length ]]"><div class="overlay"><div class="align-center"><p>You don't have any bids</p></div></div></template></div></main><iron-pages id="subPages" attr-for-selected="data-page" selected="[[subPage]]"><section data-page="bid" class="sub-page"><grid-bid gmap="[[gmap]]" map="{{map}}" bid-id="[[bid.id]]"></grid-bid></section></iron-pages><template is="dom-if" if="[[isLoading]]"><div class="overlay lgrey-bg" style="margin-top: 64px"><div class="align-center"><paper-spinner active$="[[isLoading]]"></paper-spinner></div></div></template><paper-dialog id="deleteDialog" class="dialog-dark"><h2>Remove Bid?</h2><div><p>Removing this bid is permanent.</p></div><div class="buttons"><paper-button dialog-dismiss="" autofocus="">No</paper-button><paper-button dialog-confirm="" on-tap="removeBid">Yes</paper-button></div></paper-dialog><paper-dialog id="highlightDialog" class="dialog-dark"><h2>Highlight</h2><div><p>Are you sure you want to highlight this bid?</p></div><div class="buttons"><paper-button dialog-dismiss="" autofocus="">No</paper-button><paper-button dialog-confirm="" on-tap="highlightBid">Yes</paper-button></div></paper-dialog><paper-toast id="genericToast" duration="3000" class="fit-bottom"></paper-toast></template><script>class GridBids extends GridNavigation(ReduxAsyncActionBehavior(ReduxBehavior(Polymer.Element))){static get is(){return'grid-bids'}static get properties(){return{user:{type:Object,statePath:'user'},auth:{type:Boolean,statePath:'auth'},bids:{type:Array,statePath:'bids'},map:{type:Object,notify:!0},isLoading:{type:Boolean,value:!0},query:{type:Array,value:[]}}}static get observers(){return['_subrouteChange(subroute)','_subrouteDataChange(subrouteData)','_postChange(post)','_search(search)']}_postChange(){}static get actions(){return{}}constructor(){super(),this._initSocketEvents()}get genericToast(){return this.shadowRoot.querySelector('#genericToast')}connectedCallback(){super.connectedCallback(),this.populateBids(),setInterval(()=>{const a=this.shadowRoot.querySelectorAll('[data-time]');a&&a.forEach((a)=>{let b=a.dataset.time;a.textContent=this._fromNow(b)})},1e3),this.headerAnimate()}headerAnimate(){const a=this.shadowRoot.querySelector('#toolbar'),b=this.shadowRoot.querySelector('main'),c=this.shadowRoot.querySelector('#toolbar-title'),d=this.shadowRoot.querySelector('#main-title'),e=16;let f=0,g=0;const h=()=>{const a=c.offsetHeight,b=d.offsetHeight;if(g>=e&&g<=e+b){f=g-e;let d=a-f*(a/b);c.style.cssText=`transform: translateY(${d}px); transition-duration: 0ms`}g>=e+b&&(c.style.transform=`translateY(0)`,c.style.transitionDuration=`100ms`),g<=e&&(c.style.transform=`translateY(${a}px)`,c.style.transitionDuration=`100ms`)};b.addEventListener('scroll',()=>{let c=b.scrollTop;0<c?a.classList.add('shadow'):a.classList.remove('shadow'),g=c,requestAnimationFrame(h)})}populateBids(){if(!this.user)return;const a=(a)=>{this.dispatch('setBids',a.data),this.pagination={total:a.total,per_page:a.per_page,current_page:a.current_page,last_page:a.last_page,next_page_url:a.next_page_url,prev_page_url:a.prev_page_url,from:a.from,to:a.to},this.isLoading=!1};((a)=>gAxios.get(a,{headers:{}}).catch(function(){return null}))(`/users/${this.user.id}/bids`).then((b)=>!!b&&!!b.data&&(a(b.data),!0)),((a)=>'serviceWorker'in navigator&&navigator.serviceWorker.controller?gAxios.get(a,{headers:{Cached:'yes'}}).catch(function(){return null}):Promise.resolve(null))(`/users/${this.user.id}/bids`).then((b)=>!!b&&!!b.data&&(a(b.data),!0))}refreshBids(){this.populateBids()}viewBid(a){const b=a.model.bid.id;this.redirect('/bids/'+b),this._bid=a.model.bid}openRemoveBidDialog(a){const b=this.shadowRoot.querySelector('#deleteDialog');b.open(),this.bid_to_delete=a.model.bid}removeBid(){if(!this.bid_to_delete)return;const a=this.bid_to_delete;this.isLoading=!0,gAxios.post(`/users/${this.user.id}/bids/${a.id}/remove`,{}).then(()=>{this.dispatch('removeBid',a),this.genericToast.text='Bid successfully deleted',this.genericToast.open()}).catch(()=>{}).then(()=>{this.isLoading=!1})}openSearchBar(){const a=this.shadowRoot.querySelector('.top-search-bar');a.classList.add('active'),a.querySelector('input').focus()}closeSearchBar(){this.shadowRoot.querySelector('.top-search-bar').classList.remove('active')}clearSearchBar(){this.search='';const a=this.shadowRoot.querySelector('.top-search-bar');a.querySelector('input').focus()}openHighlightDialog(a){return a.model.bid.is_highlighted?(this.genericToast.text='Bid is already highlighted',void this.genericToast.open()):void(this.shadowRoot.querySelector('#highlightDialog').open(),this.bid_to_highlight=a.model.bid)}highlightBid(){if(this.bid_to_highlight){const a=this.bid_to_highlight;this.isLoading=!0,gAxios.post(`/users/${this.user.id}/bids/${a.id}/highlight`).then((a)=>{console.log(a.data),this.dispatch('updateBid',a.data),this.genericToast.text='Bid successfully highlighted',this.genericToast.open()}).catch(()=>{}).then(()=>{this.isLoading=!1})}}_search(b){let c=this.query.slice(0);b||(c.search=null),b&&(c.search=b),this.set('query',c)}filterCheck(a){const b=a.target;if(b.checked)this.push('query',b.value);else{const a=this.query.indexOf(b.value);-1!=a&&this.query.splice(a,1)}const c=this.query.slice(0);this.set('query',c)}_filterBids(a){this;return a.length||a.search?function(b){if(a.search){let c=a.search.toLowerCase(),d=b.job.name.toLowerCase();if(-1==d.indexOf(c))return!1}return!a.length||-1!=a.indexOf(b.job.status.toString())}:null}_fromNow(a){return moment(a).fromNow()}_subrouteChange(a){''==a.path&&(this.set('subrouteData.id',null),this.subPage=null)}_subrouteDataChange(a){const b=this;a.id?this.shadowRoot.querySelector('#bids-'+a.id)?Polymer.Base.importHref('/elements/thegrid/pages/bids/grid-bids-'+a.id+'.html?v=1.0.1',()=>{b.subPage=a.id}):b.subPage='bid':b.subPage=null}_initSocketEvents(){socket.on('user:bidded',(a)=>{if(this.auth&&a.user.id==this.user.id){const a=this.bids.find((a)=>a.id==res.data.id);a?this.dispatch('updateBid',res.data):this.dispatch('addBid',res.data)}}),socket.on('user:other_bidded',(a)=>{if(this.auth){gAxios.get(`/users/${this.user.id}/bids/${a}`).then((a)=>{const b=this.bids.find((b)=>b.id==a.data.id);b?this.dispatch('updateBid',a.data):this.dispatch('addBid',a.data)}).then(()=>{this.isLoading=!1})}}),socket.on('user:grant_job',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:cancel_grant_job',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:job_in_progress',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.bid_id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:job_review',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.bid_id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:job_complete',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.bid_id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:reply_query',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:like_query',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:dislike_query',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})}),socket.on('user:add_query',(a)=>{this.auth&&gAxios.get(`/users/${this.user.id}/bids/${a.id}`).then((a)=>{this.dispatch('updateBid',a.data)}).then(()=>{this.isLoading=!1})})}_getStatus(a){if(a.winner){if(a.job.is_completed)return`Completed ${this._fromNow(a.job.updated_at)}`;if(a.job.is_moving)return`In Progress ${this._fromNow(a.job.updated_at)}`;if(a.job.is_awarded)return`Awarded ${this._fromNow(a.job.updated_at)}`}return!a.winner&&a.job.is_awarded?`Awarded to other ${this._fromNow(a.job.updated_at)}`:`Waiting since ${this._fromNow(a.created_at)}`}_isUserAccepted(a){return!(2!=a)}}customElements.define(GridBids.is,GridBids);</script></dom-module></body></html>