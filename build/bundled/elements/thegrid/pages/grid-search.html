<html><head></head><body><dom-module id="grid-search"><template><style include="grid iron-flex">:host{height:100%;background:var(--light-grey);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;}.search-box{padding:0 0 16px 16px;}.search-input{outline:none;border:none;border-bottom:1px solid rgba(255, 255, 255, 0.7);font-size:34px;background:transparent;color:#FFFFFF;width:100%;}.scroll-area{}.search-result{border-top:1px solid rgba(255, 255, 255, 0.12);padding:8px 0;}.search-result .job-info{color:#FFFFFF;}.search-result .job-info .job-name{font-weight:400;}.search-result .job-info .job-date{font-weight:300;font-size:12px;}.search-result .job-avatar{background:#FFFFFF;height:36px;width:36px;}.recent-searches-title{font-size:20px;line-height:20px;margin-bottom:8px;}.recent-searches-title span{font-size:14px;}.recent-searches-item{padding:8px 0;cursor:pointer;}main{overflow:auto;}</style><app-location route="{{route}}"></app-location><app-route route="{{route}}" pattern="/search/:q" data="{{query}}"></app-route><div id="toolbar" class="toolbar"><paper-icon-button icon="close" class="red pointer" on-click="redirectHome"></paper-icon-button><span class="flex"></span></div><div class="search-box"><input id="search-input" type="text" class="search-input" placeholder="Start Searching..." value="{{q::input}}"></div><main class="flex"><div class="p-y-1"><div class="white" hidden$="[[!show_recent_searches]]"><div class="flex layout horizontal recent-searches-title"><div class="flex">Recent</div><span on-click="clearRecentSearch" class="red pointer">Clear</span></div><template is="dom-repeat" items="[[recent_searches]]" as="search"><div class="red recent-searches-item" on-click="searchThis">[[search]]</div></template></div><div hidden$="[[!searching]]" class="white">Searching...</div><section class="search-results" hidden$="[[searching]]"><template is="dom-repeat" items="[[search_results]]" as="job"><div class="search-result flex layout horizontal pointer" on-click="viewJob"><div class="flex job-info"><div class="job-name">[[job.name]]</div><div class="job-date">[[_roundDistance(job.distance)]] : [[_fromNow(job.date)]]</div></div><template is="dom-if" if="[[job.files.length]]"><div class="job-avatar" style$="background-image: url([[_getFilePath(job.files.0.path)]]); background-size: cover; background-position: center;"></div></template></div></template></section><div hidden$="[[!no_result]]" class="white">No results from your search...</div><template is="dom-if" if="[[ recommended_jobs.length ]]"><br><div class="flex layout horizontal recent-searches-title"><div class="flex white">Related to your tags</div></div><template is="dom-repeat" items="[[ recommended_jobs ]]" as="job"><div class="search-result flex layout horizontal pointer" on-click="viewJob"><div class="flex job-info"><div class="job-name">[[job.name]]</div><div class="job-date">[[_fromNow(job.date)]]</div></div><template is="dom-if" if="[[job.files.length]]"><div class="job-avatar" style$="background-image: url([[_getFilePath(job.files.0.path)]]); background-size: cover; background-position: center;"></div></template></div></template></template><template is="dom-if" if="[[ popular_jobs.length ]]"><br><div class="flex layout horizontal recent-searches-title"><div class="flex white">Popular</div></div><template is="dom-repeat" items="[[ popular_jobs ]]" as="job"><div class="search-result flex layout horizontal pointer" on-click="viewJob"><div class="flex job-info"><div class="job-name">[[job.name]]</div><div class="job-date">[[_fromNow(job.date)]]</div></div><template is="dom-if" if="[[job.files.length]]"><div class="job-avatar" style$="background-image: url([[_getFilePath(job.files.0.path)]]); background-size: cover; background-position: center;"></div></template></div></template></template></div></main><template is="dom-if" if="[[search_results.length]]"><paper-button class="white w-100" on-click="viewResultsOnMap">View results on map</paper-button></template></template><script>class GridSearch extends GridNavigation(ReduxBehavior(Polymer.Element)){static get is(){return'grid-search'}static get properties(){return{user:{type:Object,statePath:'user'},search_results:{type:Object,value:null},searching:{type:Boolean,value:!1},no_result:{type:Boolean,value:!1},recent_searches:{type:Object,value:function(){return[]}},show_recent_searches:{type:Boolean,value:!0},page:{observer:'_pageChange'}}}static get observers(){return['_queryChange(query)','_queryInputChange(q)','_countRecentSearches(recent_searches)']}static get actions(){return{}}constructor(){super();var a=window.localStorage.getItem('recent_searches');a&&(this.recent_searches=JSON.parse(a))}connectedCallback(){super.connectedCallback();const a=this,b=this.shadowRoot.querySelector('#search-input');this.user&&(this.getRelatedJobs(),this.getPopularJobs());b.addEventListener('keyup',function(b){13==b.keyCode&&a.redirect(`/search/${a.q}`)}),window.addEventListener('searching',()=>{a.searching=!0}),window.addEventListener('done-searching',()=>{a.searching=!1}),window.addEventListener('map:clear_search',()=>{this.set('search_results',[]),this.q=''}),window.addEventListener('location:back',()=>{const a=this.shadowRoot.querySelectorAll('input');a.forEach((a)=>{a.blur()})})}getRelatedJobs(){gAxios.get(`/users/${this.user.id}/related/jobs`).then((a)=>{this.recommended_jobs=a.data})}getPopularJobs(){gAxios.get(`/users/${this.user.id}/popular/jobs`).then((a)=>{this.popular_jobs=a.data})}search(){if(this.searching)return;this.recent_searches.includes(this.q)||this.push('recent_searches',this.q),window.localStorage.setItem('recent_searches',JSON.stringify(this.recent_searches)),window.dispatchEvent(new CustomEvent('searching')),this.set('search_results',[]),this.no_result=!1,this.searching=!0;let a=`${this.url.API_URL}/jobs/search?q=${this.q}`,b=axios;this.user&&(a=`/users/jobs/search?q=${this.q}`,b=gAxios);const c=this.gmap.currentLocation;c&&(a+=`&lat=${c.lat}&lng=${c.lng}`),b.get(a).then((a)=>{0<a.data.length?this.set('search_results',a.data):this.no_result=!0}).catch((a)=>{console.log(a.response)}).then(()=>{window.dispatchEvent(new CustomEvent('done-searching')),this.searching=!1})}viewJob(a){const b=a.model.job;if(b){const a=new google.maps.LatLng(b.lat,b.lng);this.gmap.map.setCenter(a),this.gmap.map.setZoom(20);const c=this.gmap.findBy((a)=>a.id==b.id);c.length||this.gmap.newMarker(b),this.redirectHome()}}searchThis(a){this.redirect(`/search/${a.model.search}`)}clearRecentSearch(){window.localStorage.removeItem('recent_searches'),this.set('recent_searches',[]),this.set('search_results',[])}viewResultsOnMap(){if(this.search_results){const a=this.gmap;a.paintMarkers(this.search_results,!0),a.openClearSearch(),this.redirectHome()}}_fromNow(a){return moment(a).fromNow()}_queryChange(a){a.q&&(this.q=a.q,this.search())}_queryInputChange(a){this.show_recent_searches=!a}_countRecentSearches(a){this.show_recent_searches=!!(0<a.length)}_roundDistance(a){if(!a)return 0;const b=a.toFixed(2);if(1>b){return`${1e3*b}m`}return`${b}km`}_getFilePath(a){return`${this.url.API_BASE_URL}/uploads/${a}`}_pageChange(a){if('search'!=a){const a=this.shadowRoot.querySelector('#search-input');a&&a.blur()}}}customElements.define(GridSearch.is,GridSearch);</script></dom-module></body></html>