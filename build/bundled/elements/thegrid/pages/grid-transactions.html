<html><head></head><body><div hidden="" by-polymer-bundler=""><link rel="import" href="transactions/grid-transaction.html"></div><dom-module id="grid-transactions"><template><style include="grid iron-flex">:host{display:block;position:relative;height:100%;background:var(--light-grey);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;}.title h1{font-weight:400;font-size:32px;}.row{color:#FFFFFF;padding:8px 16px;position:relative;cursor:pointer;}.row .job-title{line-height:24px;font-size:18px;}.row [secondary]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.7;}.divider{padding:0 16px;}.divider hr{margin:0;opacity:0.12;}.time{font-size:12px;opacity:0.7;}.transactions-summary{}.expenses, .earnings{width:50%;text-align:center;}.expenses .amount, .earnings .amount{font-size:24px;display:block;}</style><div id="toolbar" class="toolbar"><paper-icon-button icon="first-page" class="red pointer" on-click="redirectHome"></paper-icon-button><div class="flex" style="overflow: hidden"><span id="toolbar-title">Transactions</span></div><paper-icon-button icon="search" class="red pointer" on-click="openSearchBar"></paper-icon-button><paper-menu-button horizontal-align="right" vertical-align="top" ignore-select="true"><paper-icon-button icon="more-vert" slot="dropdown-trigger" class="red"></paper-icon-button><div slot="dropdown-content" class="dropdown-menu"><div class="item" on-click="refreshTransactions"><span>Refresh</span><paper-ripple></paper-ripple></div><div class="item-title"><span>Show only</span></div><div class="item"><paper-checkbox value="p" on-change="filterCheck">Payables</paper-checkbox></div><div class="item"><paper-checkbox value="r" on-change="filterCheck">Receivables</paper-checkbox></div></div></paper-menu-button></div><div class="top-search-bar"><div class="toolbar"><div class="input-group suffix prefix"><div class="addon-prefix has-button"><paper-icon-button icon="chevron-left" class="pointer" on-click="closeSearchBar"></paper-icon-button></div><input type="text" class="input" value="{{ search::input }}" placeholder="Search..."><div class="addon-suffix has-button"><paper-icon-button icon="close" class="pointer" on-click="clearSearchBar"></paper-icon-button></div></div></div></div><main class="flex relative"><section class="p-y-1 title"><h1 id="main-title" class="white m-0">Transactions</h1></section><div class="white" role="listbox"><template is="dom-repeat" items="[[ transactions ]]" as="trans" filter="{{ _filterTransactions(query) }}"><paper-item id$="[[ trans.id ]]" on-click="viewTransaction"><paper-item-body two-line=""><div>[[ trans.job.name ]]</div><div secondary="">[[ trans.job.country.currency_unit ]] [[ trans.amount ]] [[ _transactionType(trans.customer, trans.supplier) ]]</div><paper-ripple></paper-ripple></paper-item-body><div class="time" data-time$="[[ trans.created_at ]]">[[ _fromNow(trans.created_at) ]]</div></paper-item></template><template is="dom-if" if="[[ !transactions.length ]]"><div class="overlay"><div class="align-center"><p>You don't have any transactions</p></div></div></template></div></main><div class="transactions-summary p-1 white dgrey-bg"><div class="layout horizontal flex"><div class="expenses">Total expenses <span class="amount">AED [[ totalExpenses ]]</span></div><div class="earnings">Total earnings <span class="amount">AED [[ totalEarnings ]]</span></div></div></div><app-route route="{{route}}" pattern="/transactions" data="{{routeData}}" tail="{{subroute}}"></app-route><app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}"></app-route><app-route route="{{route}}" pattern="/transactions/:id" data="{{transaction}}"></app-route><iron-pages attr-for-selected="data-page" selected="[[subPage]]"><section data-page="transaction" class="sub-page"><grid-transaction transaction-id="[[transaction.id]]" gmap="[[gmap]]"></grid-transaction></section></iron-pages><template is="dom-if" if="[[isLoading]]"><div class="overlay lgrey-bg" style="margin-top: 64px"><div class="align-center"><paper-spinner active$="[[isLoading]]"></paper-spinner></div></div></template></template><script>class GridTransactions extends GridNavigation(ReduxAsyncActionBehavior(ReduxBehavior(Polymer.Element))){static get is(){return'grid-transactions'}static get properties(){return{user:{type:Object,statePath:'user'},auth:{type:Boolean,statePath:'auth'},transactions:{type:Array,statePath:'transactions'},isLoading:{type:Boolean,value:!0},query:{type:Array,value:[]},search:String}}static get observers(){return['_subrouteChange(subroute)','_subrouteDataChange(subrouteData)','_search(search)','_transactionsChange(transactions)']}constructor(){super(),this._initSocketEvents()}connectedCallback(){super.connectedCallback(),this.populateTransactions(),this.headerAnimate()}headerAnimate(){const a=this.shadowRoot.querySelector('#toolbar'),b=this.shadowRoot.querySelector('main'),c=this.shadowRoot.querySelector('#toolbar-title'),d=this.shadowRoot.querySelector('#main-title'),e=16;let f=0,g=0;const h=()=>{const a=c.offsetHeight,b=d.offsetHeight;if(g>=e&&g<=e+b){f=g-e;let d=a-f*(a/b);c.style.cssText=`transform: translateY(${d}px); transition-duration: 0ms`}g>=e+b&&(c.style.transform=`translateY(0)`,c.style.transitionDuration=`100ms`),g<=e&&(c.style.transform=`translateY(${a}px)`,c.style.transitionDuration=`100ms`)};b.addEventListener('scroll',()=>{let c=b.scrollTop;0<c?a.classList.add('shadow'):a.classList.remove('shadow'),g=c,requestAnimationFrame(h)})}populateTransactions(){if(!this.user)return;const a=(a)=>{this.dispatch('setTransactions',a.data),this.pagination={total:a.total,per_page:a.per_page,current_page:a.current_page,last_page:a.last_page,next_page_url:a.next_page_url,prev_page_url:a.prev_page_url,from:a.from,to:a.to},this.isLoading=!1};((a)=>gAxios.get(a,{headers:{}}).catch(function(){return null}))(`/users/${this.user.id}/transactions`).then((b)=>!!b&&!!b.data&&(a(b.data),!0)),((a)=>'serviceWorker'in navigator&&navigator.serviceWorker.controller?gAxios.get(a,{headers:{Cached:'yes'}}).catch(function(){return null}):Promise.resolve(null))(`/users/${this.user.id}/transactions`).then((b)=>!!b&&!!b.data&&(a(b.data),!0))}viewTransaction(a){const b=a.model.trans;this.redirect(`/transactions/${b.id}`),this._trans=b}openSearchBar(){const a=this.shadowRoot.querySelector('.top-search-bar');a.classList.add('active'),a.querySelector('input').focus()}closeSearchBar(){this.shadowRoot.querySelector('.top-search-bar').classList.remove('active')}clearSearchBar(){this.search='';const a=this.shadowRoot.querySelector('.top-search-bar');a.querySelector('input').focus()}refreshTransactions(){this.populateTransactions()}filterCheck(a){const b=a.target;if(b.checked)this.push('query',b.value);else{const a=this.query.indexOf(b.value);-1!=a&&this.query.splice(a,1)}const c=this.query.slice(0);this.set('query',c)}_search(b){let c=this.query.slice(0);b||(c.search=null),b&&(c.search=b),this.set('query',c)}_filterTransactions(a){const b=this;return a.length||a.search?function(c){if(a.search){let b=a.search.toLowerCase(),d=c.job.name.toLowerCase();if(-1==d.indexOf(b))return!1}if(!a.length)return!0;const d=b._transactionType(c.customer,c.supplier).toLowerCase();return-1!=a.indexOf('p')&&-1!=a.indexOf('r')?'payable'==d||'receivable'==d:-1==a.indexOf('p')?-1==a.indexOf('r')?void 0:'receivable'==d:'payable'==d}:null}_fromNow(a){return moment(a).fromNow()}_subrouteChange(a){''==a.path&&(this.set('subrouteData.id',null),this.subPage=null)}_subrouteDataChange(a){const b=this;a.id?this.shadowRoot.querySelector('#transactions-'+a.id)?Polymer.Base.importHref('/elements/thegrid/pages/transactions/grid-transactions-'+a.id+'.html?v=1.0.1',()=>{b.subPage=a.id}):b.subPage='transaction':b.subPage=null}_transactionType(a,b){return this.user?this.user.id==a.id?'Payable':this.user.id==b.id?'Receivable':void 0:void 0}_transactionsChange(a){a.length&&(this.totalExpenses=0,this.totalEarnings=0,a.forEach((a)=>{let b=this._transactionType(a.customer,a.supplier);'Payable'==b?this.totalExpenses+=a.bid.price_bid:'Receivable'==b&&(this.totalEarnings+=a.bid.price_bid)}),this.totalExpenses=this.totalExpenses.toLocaleString(),this.totalEarnings=this.totalEarnings.toLocaleString())}_initSocketEvents(){}}customElements.define(GridTransactions.is,GridTransactions);</script></dom-module></body></html>