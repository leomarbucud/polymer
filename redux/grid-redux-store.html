<link rel="import" href="/bower_components/polymer-redux/polymer-redux.html">

<script>

  const API_BASE_URL = 'https://api.thegrid.com';
  // const API_BASE_URL = 'https://dev.thegrid.com';
  const API_URL = API_BASE_URL + '/api';
  // const APP_URL = 'http://10.0.0.10:8080/#/';
  const APP_URL = '/';
  const HOME_URL = APP_URL;
  const LOGIN_URL = APP_URL + 'login';
  const REGISTER_URL = APP_URL + 'register';
  const FORGOT_URL = APP_URL + 'forgot';
  const PROFILE_URL = APP_URL + 'profile';
  const VERIFY_URL = APP_URL + 'verification';
  const SETUP_URL = APP_URL + 'profile/setup';

  const intialState = {
    user: null,
    token: null,
    auth: false
  };

  const reducer = (state, action) => {
    if( !state ) return intialState;
    switch (action.type) {

      case 'LOGGED_USER':
        const user = action.user;
        return Object.assign({}, state, { user: user, auth: true } );

      case 'LOGOUT_USER':
        return Object.assign({}, state, { user: null, auth: false, token: null } );

      case 'ASSIGN_TOKEN':
        const token = action.token;
        return Object.assign({}, state, { token: token });

      case 'GIVE_ACCESS':
        const _token = action.token;
        const _user = action.user;
        return Object.assign({}, state, { token: _token, user: _user, auth: true });

    }
  };

  const store = Redux.createStore(reducer);
  const ReduxBehavior = PolymerRedux(store);

  window.gAxios = null;

  checkLogin = () => {
    if( localStorage.getItem('token') ) {

      // const access_token = JSON.parse(localStorage.getItem('token'))['access_token'];
      const access_token = localStorage.getItem('token');

      if(access_token) {

        gAxios = axios.create({
          baseURL: API_URL,
          headers: {
            'Authorization': 'Bearer ' + access_token
          }
        });
        return true;
      }
      return false;
    }
    return false;
  }

  checkLogin();

  redirect = url => {
    if( ! url ) return;
    // window.location.href = url;
    window.history.pushState({}, null, url);
    window.dispatchEvent(new CustomEvent('location-changed'));
  }

</script>
