<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/elements/thegrid/grid-styles.html">

<dom-module id="grid-profile">
  <template>
    <style include="grid iron-flex">

      :host {
        display: block;
        position: relative;
        width: 100%;
        height: 100%;
        margin: 0 auto;
        background: linear-gradient(209.36deg, #FF3B30 0%, #FF2D55 100%);
      }
      .header-action {
        height: 56px;
        padding: 16px;
      }

    </style>

    <!-- <app-location route="{{route}}" use-hash-as-path></app-location> -->
    <app-location route="{{route}}" ></app-location>

		<app-route route="{{route}}"
		    pattern="/:page"
		    data="{{routeData}}"
		    tail="{{subroute}}"></app-route>

		<app-route route="{{subroute}}"
		    pattern="/:id"
		    data="{{subrouteData}}"></app-route>

    <div class="header-action flex layout horizontal">
      <iron-icon icon="close" class="white pointer" on-click="redirectHome"></iron-icon>
      <span class="flex"></span>
    </div>

    <a href="/profile/skills">Skills</a>

    <iron-pages attr-for-selected="data-page" selected="[[subPage]]">

      <section data-page="setup" class="sub-page">
        <grid-setup id="setup"></grid-setup>
      </section>

      <section data-page="skills" class="sub-page">
        <grid-skills id="skills"></grid-skills>
      </section>

    </iron-pages>

  </template>

  <script>

    class GridProfile extends GridNavigation(ReduxBehavior(Polymer.Element)) {

      static get is() { return 'grid-profile'; }

      static get properties() {
        return {
          user: {
            type: Object,
            statePath: 'user'
          }
        }
      }

      static get observers() {
        return [
          '_subrouteChange(subroute)',
          '_subrouteDataChange(subrouteData)',
        ]
      }

      static get actions() {
  			return {
  				login(user) {
  					return {
  						type: 'LOGGED_USER',
  						user: user
  					}
  				}
  			};
  		}

      constructor() {
        super();

      }

      connectedCallback() {
        super.connectedCallback();

      }

      _subrouteChange(subroute) {
				if( subroute.path == '' ) {
					this.set('subrouteData.id', null);
          this.subPage = null;
				}
			}

      _subrouteDataChange(subrouteData) {
        const self = this;
        if( subrouteData.id ) {
          Polymer.Base.importHref(
						'/elements/thegrid/pages/profile/grid-' + subrouteData.id + '.html',
						() => {
              self.subPage = subrouteData.id;
						}
					);
        } else {
          self.subPage = null;
        }
      }

    }

    customElements.define(GridProfile.is, GridProfile);
	</script>
</dom-module>
