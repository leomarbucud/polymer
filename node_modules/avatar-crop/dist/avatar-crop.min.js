!function(){function a(a){var b={};for(var c in a)b[c]=a[c];return b}function b(a,b,c){this.name=a,this.fn=b,this.configs=c||{}}function c(a,b){if(!a)throw"Missing element.";this.canvas=c.createBoard(),this._callbacks={},this.filters=[],this.config(b),a.appendChild(this.canvas),this.clear()}var d=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),e={interactive:!0,droppable:!0,selectable:!0,width:null,height:null,message:"Drop an image or click to select one.",minZoom:1,maxZoom:1/0};b.prototype.exec=function(a,b){this.fn.call(this,a,b)},b.prototype.config=function(a){for(var b in a)this.configs[b]=a[b]},c.DEFAULT_WIDTH=256,c.DEFAULT_HEIGHT=256,c.DEFAULT_WHEEL_FACTOR=100,c.DEFAULT_ANIM_DURATE=250,c.DEFAULT_MODE="fit",c.filters={},c.Filter=b,c.addFilter=function(a,b,d){c.filters[a]={fn:b,defaults:d}},c.createBoard=function(){var a=document.createElement("canvas");return a.style.border="solid 1px #DDD",a.style.backgroundColor="#FFF",a.style.backgroundImage='url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzIgMzIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxyZWN0IGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjxyZWN0IHg9IjE2IiB5PSIxNiIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+")',a.style.userSelect="none",a.style.webkitUserSelect="none",a},c.prototype.config=function(b){var d=a(this.options||{}),f=this.options||a(e);if(b)for(var g in b)"undefined"!=typeof f[g]&&(f[g]=b[g]);this.canvas&&(this.canvas.width=f.width||c.DEFAULT_WIDTH,this.canvas.height=f.height||c.DEFAULT_HEIGHT,f.interactive&&!d.interactive?this.bindInteractive():d.interactive&&this.unbindInteractive(),f.droppable&&!d.droppable?this.bindDroppable():d.droppable&&this.unbindDroppable(),f.selectable&&!d.selectable?this.bindSelectable():d.selectable&&this.unbindSelectable()),this.options=f},c.prototype.addEventListener=function(a,b){this._callbacks[a]=this._callbacks[a]||[],this._callbacks[a].push(b)},c.prototype.fire=function(a){for(var b=this._callbacks[a]||[],c=0,d=b.length;d>c;c++)b[c].apply(this)},c.prototype.bindInteractive=function(){function a(a){g.data&&(i=a.clientX+g._offsetX,j=a.clientY+g._offsetY,l=!0)}function b(a){l=!1}function d(a){l&&g.move(a.clientX-i,a.clientY-j)}function e(a){if(g.data){if(l)return!0;a.stopPropagation(),a.preventDefault();var b=-(a.detail?-120*a.detail:a.wheelDelta)/c.DEFAULT_WHEEL_FACTOR;return g.zoom(g._zoom+b),k=b,!1}}function f(a){return g.data?(a.stopPropagation(),a.preventDefault(),1==g._zoom?0==g._offsetX&&0==g._offsetY?g.fill():g.center():g.fit(),!1):void 0}var g=this,h=this.canvas,i=(h.getContext("2d"),0),j=0,k=0,l=!1;h.addEventListener("mousedown",a,!1),h.addEventListener("mousemove",d,!1),h.addEventListener("mouseup",b,!1),h.addEventListener("mouseout",b,!1),h.addEventListener("dblclick",f,!1),h.addEventListener("mousewheel",e,!1),h.addEventListener("DOMMouseScroll",e,!1)},c.prototype.unbindInteractive=function(){var a=this.canvas;a.removeEventListener("mousedown"),a.removeEventListener("mousemove"),a.removeEventListener("mouseup"),a.removeEventListener("mouseout"),a.removeEventListener("dblclick"),a.removeEventListener("mousewheel"),a.removeEventListener("DOMMouseScroll")},c.prototype.bindDroppable=function(){var a=this,b=this.canvas;"undefined"!=typeof FileReader&&(b.addEventListener("drop",function(b){b.preventDefault();var c=b.dataTransfer.files;c.length>0&&a.handleFile(c[0])}),b.addEventListener("dragover",function(a){a.preventDefault()},!1))},c.prototype.unbindDroppable=function(){var a=this.canvas;a.removeEventListener("dragover"),a.removeEventListener("drop")},c.prototype.bindSelectable=function(){var a=this,b=this.canvas;b.addEventListener("click",function(b){if(!a.data){var c=document.createElement("input");c.type="file",c.style.visibility="hidden",document.body.appendChild(c);var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0),d.synthetic=!0,c.addEventListener("change",function(b){this.files&&this.files[0]&&a.handleFile(this.files[0]),c.parentNode&&document.body.removeChild(c)}),setTimeout(function(){c.parentNode&&document.body.removeChild(c)},2e4),c.dispatchEvent(d,!0)}})},c.prototype.unbindSelectable=function(){var a=this.canvas;a.removeEventListener("click")},c.prototype.setLoadState=function(a){var b=this,c=Date.now(),e=16,f=this.canvas,g=f.width,h=f.height,i=f.getContext("2d");if(a){b._loading=!0,f.style.cursor="progress";var j=function(){d(function(){var a=parseInt((new Date-c)/1e3*e)/e;i.save(),i.clearRect(0,0,g,h),i.translate(g/2,h/2),i.rotate(2*Math.PI*a);for(var d=0;e>d;d++)i.beginPath(),i.rotate(2*Math.PI/e),i.moveTo(g/10,0),i.lineTo(g/4,0),i.lineWidth=g/30,i.strokeStyle="rgba(0, 0, 0,"+d/e+")",i.stroke();i.restore(),b._loading&&j()})};j()}else i.clearRect(0,0,g,h),f.style.cursor="default",delete this._loading},c.prototype.handleFile=function(a){if(-1!==a.type.indexOf("image")){var b=this,c=new FileReader;b.setLoadState(!0),b.canvas.style.cursor="progress",c.onload=function(a){b.setLoadState(!1),b.setSource(a.target.result)},c.onerror=function(){b.setLoadState(!1)},c.readAsDataURL(a)}},c.prototype.setSource=function(a){var b=this,c=this.canvas,d=new Image;b.setLoadState(!0),d.addEventListener("load",function(){b.fire("load"),b.setLoadState(!1),b.data=d,b.reset(),b.options.interactive?c.style.cursor="move":c.style.cursor="default"}),img.addEventListener("error",function(){b.setLoadState(!1)}),d.src=a},c.prototype.fit=function(a){this.moveAndZoom(0,0,1,a||c.DEFAULT_ANIM_DURATE)},c.prototype.fill=function(a){if(this.data){var b=this.data,d=b.width,e=b.height;e>d?this.moveAndZoom(0,0,e/d,a||c.DEFAULT_ANIM_DURATE):this.moveAndZoom(0,0,d/e,a||c.DEFAULT_ANIM_DURATE)}},c.prototype.move=function(a,b,c){this.moveAndZoom(a,b,this._zoom,c)},c.prototype.zoom=function(a,b){var c=-this._offsetX/this._zoom*a,d=-this._offsetY/this._zoom*a;this.moveAndZoom(c,d,a,b)},c.prototype.moveAndZoom=function(a,b,c,e){function f(a,b,c){g._offsetX=a,g._offsetY=b,g._zoom=c,g.render()}if(this.data){e=e||0,a=-a,b=-b;var g=this,h=this.options,i=Date.now(),j=i+e,k=this._zoom,l=this._offsetX,m=this._offsetY,n=c-k,o=a-l,p=b-m;if(c=Math.min(Math.max(c,h.minZoom),h.maxZoom),e){var q=function(){d(function(){var a=Date.now(),b=Math.min(a-i,e)/e,c=n*b,d=k+c,g=o*b,h=l+g,r=p*b,s=m+r;f(h,s,d),j>a&&q()},10)};q()}else f(a,b,c)}},c.prototype.reset=function(a){"function"==typeof this[c.DEFAULT_MODE]&&this[c.DEFAULT_MODE].call(this,a)},c.prototype.center=function(a){this.moveAndZoom(0,0,this._zoom,a||c.DEFAULT_ANIM_DURATE)},c.prototype.clear=function(){this.filters=[],this._offsetX=0,this._offsetY=0,this._zoom=1,this.data=null;var a=this.canvas,b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.textAlign="center",b.fillText(this.options.message,a.width/2,a.height/2),this.options.selectable&&(a.style.cursor="pointer"),this.fire("clear")},c.prototype.render=function(){if(this.data){var a=this,b=this.data,c=this._zoom,d=this.canvas,e=d.getContext("2d"),f=b.width,g=b.height,h=f/g,i=this.filters;if(e.clearRect(0,0,d.width,d.height),1>h){var j=d.height*h;e.drawImage(b,0,0,f,g,(d.width-j*c)/2-this._offsetX,(d.height-d.height*c)/2-this._offsetY,j*c,d.height*c)}else{var k=d.width/h;e.drawImage(b,0,0,f,g,(d.width-d.width*c)/2-this._offsetX,(d.height-k*c)/2-this._offsetY,d.width*c,k*c)}for(var l=0,m=i.length;m>l;l++)i[l].exec(this,d);clearTimeout(a.fireTimeout),a.fireTimeout=setTimeout(function(){a.fire("change"),delete a.fireTimeout},250)}},c.prototype.save=function(){return this.data?this.canvas.toDataURL():void 0},c.prototype.hasFilter=function(a){for(var b=this.filters,c=0,d=b.length;d>c;c++)if(b[c].name==a)return!0;return!1},c.prototype.addFilter=function(a,b){if(!this.hasFilter(a))if("function"==typeof b)this.filters.push(new c.Filter(a,b)),this.render();else if(c.filters[a]){var d=c.filters[a],e=new c.Filter(a,d.fn,d.defaults);b&&e.config(b),this.filters.push(e),this.render()}},c.prototype.removeFilter=function(a){var b=this.filters,c=0;for(b.length;c<b.length;c++)if(b[c].name==a)return this.filters.splice(c,1),this.render(),!0},c.prototype.removeAllFilters=function(){this.filters=[],this.render()},c.prototype.updateFilter=function(a,b){var c=this.filters,d=0;for(c.length;d<c.length;d++)c[d].name==a&&(c[d].config(b),this.render())},"undefined"!=typeof module?module.exports=c:"function"==typeof define&&"object"==typeof define.amd?define(function(){return{AvatarCrop:c}}):window.AvatarCrop=c}(window);
//# sourceMappingURL=avatar-crop.min.js.map