!function(){function a(a){var b={};for(var c in a)b[c]=a[c];return b}function b(a,b,c){this.name=a,this.fn=b,this.configs=c||{}}function c(a,b){if(!a)throw"Missing element.";this.canvas=c.createBoard(),this._callbacks={},this.filters=[],this.config(b),a.appendChild(this.canvas),this.clear()}var d=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),e={interactive:!0,droppable:!0,selectable:!0,width:null,height:null,message:"Drop an image or click to select one.",minZoom:1,maxZoom:1/0};b.prototype.exec=function(a,b){this.fn.call(this,a,b)},b.prototype.config=function(a){for(var b in a)this.configs[b]=a[b]},c.DEFAULT_WIDTH=256,c.DEFAULT_HEIGHT=256,c.DEFAULT_WHEEL_FACTOR=100,c.DEFAULT_ANIM_DURATE=250,c.DEFAULT_MODE="fit",c.filters={},c.Filter=b,c.addFilter=function(a,b,d){c.filters[a]={fn:b,defaults:d}},c.createBoard=function(){var a=document.createElement("canvas");return a.style.border="solid 1px #DDD",a.style.backgroundColor="#FFF",a.style.backgroundImage='url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIzMnB4IiBoZWlnaHQ9IjMycHgiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzIgMzIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxyZWN0IGZpbGw9IiNDQ0NDQ0MiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIvPjxyZWN0IHg9IjE2IiB5PSIxNiIgZmlsbD0iI0NDQ0NDQyIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+PC9zdmc+")',a.style.userSelect="none",a.style.webkitUserSelect="none",a},c.prototype.config=function(b){var d=a(this.options||{}),f=this.options||a(e);if(b)for(var g in b)"undefined"!=typeof f[g]&&(f[g]=b[g]);this.canvas&&(this.canvas.width=f.width||c.DEFAULT_WIDTH,this.canvas.height=f.height||c.DEFAULT_HEIGHT,f.interactive&&!d.interactive?this.bindInteractive():d.interactive&&this.unbindInteractive(),f.droppable&&!d.droppable?this.bindDroppable():d.droppable&&this.unbindDroppable(),f.selectable&&!d.selectable?this.bindSelectable():d.selectable&&this.unbindSelectable()),this.options=f},c.prototype.addEventListener=function(a,b){this._callbacks[a]=this._callbacks[a]||[],this._callbacks[a].push(b)},c.prototype.fire=function(a){for(var b=this._callbacks[a]||[],c=0,d=b.length;d>c;c++)b[c].apply(this)},c.prototype.bindInteractive=function(){function a(a){g.data&&(i=a.clientX+g._offsetX,j=a.clientY+g._offsetY,l=!0)}function b(a){l=!1}function d(a){l&&g.move(a.clientX-i,a.clientY-j)}function e(a){if(g.data){if(l)return!0;a.stopPropagation(),a.preventDefault();var b=-(a.detail?-120*a.detail:a.wheelDelta)/c.DEFAULT_WHEEL_FACTOR;return g.zoom(g._zoom+b),k=b,!1}}function f(a){return g.data?(a.stopPropagation(),a.preventDefault(),1==g._zoom?0==g._offsetX&&0==g._offsetY?g.fill():g.center():g.fit(),!1):void 0}var g=this,h=this.canvas,i=(h.getContext("2d"),0),j=0,k=0,l=!1;h.addEventListener("mousedown",a,!1),h.addEventListener("mousemove",d,!1),h.addEventListener("mouseup",b,!1),h.addEventListener("mouseout",b,!1),h.addEventListener("dblclick",f,!1),h.addEventListener("mousewheel",e,!1),h.addEventListener("DOMMouseScroll",e,!1)},c.prototype.unbindInteractive=function(){var a=this.canvas;a.removeEventListener("mousedown"),a.removeEventListener("mousemove"),a.removeEventListener("mouseup"),a.removeEventListener("mouseout"),a.removeEventListener("dblclick"),a.removeEventListener("mousewheel"),a.removeEventListener("DOMMouseScroll")},c.prototype.bindDroppable=function(){var a=this,b=this.canvas;"undefined"!=typeof FileReader&&(b.addEventListener("drop",function(b){b.preventDefault();var c=b.dataTransfer.files;c.length>0&&a.handleFile(c[0])}),b.addEventListener("dragover",function(a){a.preventDefault()},!1))},c.prototype.unbindDroppable=function(){var a=this.canvas;a.removeEventListener("dragover"),a.removeEventListener("drop")},c.prototype.bindSelectable=function(){var a=this,b=this.canvas;b.addEventListener("click",function(b){if(!a.data){var c=document.createElement("input");c.type="file",c.style.visibility="hidden",document.body.appendChild(c);var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0),d.synthetic=!0,c.addEventListener("change",function(b){this.files&&this.files[0]&&a.handleFile(this.files[0]),c.parentNode&&document.body.removeChild(c)}),setTimeout(function(){c.parentNode&&document.body.removeChild(c)},2e4),c.dispatchEvent(d,!0)}})},c.prototype.unbindSelectable=function(){var a=this.canvas;a.removeEventListener("click")},c.prototype.setLoadState=function(a){var b=this,c=Date.now(),e=16,f=this.canvas,g=f.width,h=f.height,i=f.getContext("2d");if(a){b._loading=!0,f.style.cursor="progress";var j=function(){d(function(){var a=parseInt((new Date-c)/1e3*e)/e;i.save(),i.clearRect(0,0,g,h),i.translate(g/2,h/2),i.rotate(2*Math.PI*a);for(var d=0;e>d;d++)i.beginPath(),i.rotate(2*Math.PI/e),i.moveTo(g/10,0),i.lineTo(g/4,0),i.lineWidth=g/30,i.strokeStyle="rgba(0, 0, 0,"+d/e+")",i.stroke();i.restore(),b._loading&&j()})};j()}else i.clearRect(0,0,g,h),f.style.cursor="default",delete this._loading},c.prototype.handleFile=function(a){if(-1!==a.type.indexOf("image")){var b=this,c=new FileReader;b.setLoadState(!0),b.canvas.style.cursor="progress",c.onload=function(a){b.setLoadState(!1),b.setSource(a.target.result)},c.onerror=function(){b.setLoadState(!1)},c.readAsDataURL(a)}},c.prototype.setSource=function(a){var b=this,c=this.canvas,d=new Image;b.setLoadState(!0),d.addEventListener("load",function(){b.fire("load"),b.setLoadState(!1),b.data=d,b.reset(),b.options.interactive?c.style.cursor="move":c.style.cursor="default"}),img.addEventListener("error",function(){b.setLoadState(!1)}),d.src=a},c.prototype.fit=function(a){this.moveAndZoom(0,0,1,a||c.DEFAULT_ANIM_DURATE)},c.prototype.fill=function(a){if(this.data){var b=this.data,d=b.width,e=b.height;e>d?this.moveAndZoom(0,0,e/d,a||c.DEFAULT_ANIM_DURATE):this.moveAndZoom(0,0,d/e,a||c.DEFAULT_ANIM_DURATE)}},c.prototype.move=function(a,b,c){this.moveAndZoom(a,b,this._zoom,c)},c.prototype.zoom=function(a,b){var c=-this._offsetX/this._zoom*a,d=-this._offsetY/this._zoom*a;this.moveAndZoom(c,d,a,b)},c.prototype.moveAndZoom=function(a,b,c,e){function f(a,b,c){g._offsetX=a,g._offsetY=b,g._zoom=c,g.render()}if(this.data){e=e||0,a=-a,b=-b;var g=this,h=this.options,i=Date.now(),j=i+e,k=this._zoom,l=this._offsetX,m=this._offsetY,n=c-k,o=a-l,p=b-m;if(c=Math.min(Math.max(c,h.minZoom),h.maxZoom),e){var q=function(){d(function(){var a=Date.now(),b=Math.min(a-i,e)/e,c=n*b,d=k+c,g=o*b,h=l+g,r=p*b,s=m+r;f(h,s,d),j>a&&q()},10)};q()}else f(a,b,c)}},c.prototype.reset=function(a){"function"==typeof this[c.DEFAULT_MODE]&&this[c.DEFAULT_MODE].call(this,a)},c.prototype.center=function(a){this.moveAndZoom(0,0,this._zoom,a||c.DEFAULT_ANIM_DURATE)},c.prototype.clear=function(){this.filters=[],this._offsetX=0,this._offsetY=0,this._zoom=1,this.data=null;var a=this.canvas,b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.textAlign="center",b.fillText(this.options.message,a.width/2,a.height/2),this.options.selectable&&(a.style.cursor="pointer"),this.fire("clear")},c.prototype.render=function(){if(this.data){var a=this,b=this.data,c=this._zoom,d=this.canvas,e=d.getContext("2d"),f=b.width,g=b.height,h=f/g,i=this.filters;if(e.clearRect(0,0,d.width,d.height),1>h){var j=d.height*h;e.drawImage(b,0,0,f,g,(d.width-j*c)/2-this._offsetX,(d.height-d.height*c)/2-this._offsetY,j*c,d.height*c)}else{var k=d.width/h;e.drawImage(b,0,0,f,g,(d.width-d.width*c)/2-this._offsetX,(d.height-k*c)/2-this._offsetY,d.width*c,k*c)}for(var l=0,m=i.length;m>l;l++)i[l].exec(this,d);clearTimeout(a.fireTimeout),a.fireTimeout=setTimeout(function(){a.fire("change"),delete a.fireTimeout},250)}},c.prototype.save=function(){return this.data?this.canvas.toDataURL():void 0},c.prototype.hasFilter=function(a){for(var b=this.filters,c=0,d=b.length;d>c;c++)if(b[c].name==a)return!0;return!1},c.prototype.addFilter=function(a,b){if(!this.hasFilter(a))if("function"==typeof b)this.filters.push(new c.Filter(a,b)),this.render();else if(c.filters[a]){var d=c.filters[a],e=new c.Filter(a,d.fn,d.defaults);b&&e.config(b),this.filters.push(e),this.render()}},c.prototype.removeFilter=function(a){var b=this.filters,c=0;for(b.length;c<b.length;c++)if(b[c].name==a)return this.filters.splice(c,1),this.render(),!0},c.prototype.removeAllFilters=function(){this.filters=[],this.render()},c.prototype.updateFilter=function(a,b){var c=this.filters,d=0;for(c.length;d<c.length;d++)c[d].name==a&&(c[d].config(b),this.render())},"undefined"!=typeof module?module.exports=c:"function"==typeof define&&"object"==typeof define.amd?define(function(){return{AvatarCrop:c}}):window.AvatarCrop=c}(window),function(){AvatarCrop.execFilter=function(a,b){var c,d,e,f=a.getContext("2d"),g=a.width,h=a.height;(b.vignette||b.lighten)&&(c=Math.sqrt(Math.pow(g/2,2)+Math.pow(h/2,2))),b.vignette&&(f.globalCompositeOperation="source-over",d=f.createRadialGradient(g/2,h/2,0,g/2,h/2,c),d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(.5,"rgba(0,0,0,0)"),d.addColorStop(1,["rgba(0,0,0,",b.vignette,")"].join("")),f.fillStyle=d,f.fillRect(0,0,g,h)),b.lighten&&(f.globalCompositeOperation="lighter",d=f.createRadialGradient(g/2,h/2,0,g/2,h/2,c),d.addColorStop(0,["rgba(255,255,255,",b.lighten,")"].join("")),d.addColorStop(.5,"rgba(255,255,255,0)"),d.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=d,f.fillRect(0,0,g,h)),e=f.getImageData(0,0,g,h);var i,j,k,l,m,n,o,p,q,r=e.data;b.contrast&&(q=259*(b.contrast+255)/(255*(259-b.contrast))),b.viewFinder&&(p=window.vjsImageCache[[g,h,b.viewFinder].join("-")]);for(var s=g*h;s>=0;--s)for(i=s<<2,b.curves&&(r[i]=b.curves.r[r[i]],r[i+1]=b.curves.g[r[i+1]],r[i+2]=b.curves.b[r[i+2]]),b.contrast&&(r[i]=q*(r[i]-128)+128,r[i+1]=q*(r[i+1]-128)+128,r[i+2]=q*(r[i+2]-128)+128),b.brightness&&(r[i]+=b.brightness,r[i+1]+=b.brightness,r[i+2]+=b.brightness),b.screen&&(r[i]=255-(255-r[i])*(255-b.screen.r*b.screen.a)/255,r[i+1]=255-(255-r[i+1])*(255-b.screen.g*b.screen.a)/255,r[i+2]=255-(255-r[i+2])*(255-b.screen.b*b.screen.a)/255),b.noise&&(o=b.noise-Math.random()*b.noise/2,r[i]+=o,r[i+1]+=o,r[i+2]+=o),b.viewFinder&&(r[i]=r[i]*p[i]/255,r[i+1]=r[i+1]*p[i+1]/255,r[i+2]=r[i+2]*p[i+2]/255),b.sepia&&(k=r[i],l=r[i+1],m=r[i+2],r[i]=.393*k+.769*l+.189*m,r[i+1]=.349*k+.686*l+.168*m,r[i+2]=.272*k+.534*l+.131*m),b.desaturate&&(n=(r[i]+r[i+1]+r[i+2])/3,r[i]+=(n-r[i])*b.desaturate,r[i+1]+=(n-r[i+1])*b.desaturate,r[i+2]+=(n-r[i+2])*b.desaturate),j=2;j>=0;--j)r[i+j]=~~(r[i+j]>255?255:r[i+j]<0?0:r[i+j]);f.putImageData(e,0,0)}}(window),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function b(b,e,f,g,h,i){if(!(isNaN(i)||1>i)){i|=0;var j,k=b.getContext("2d");try{try{j=k.getImageData(e,f,g,h)}catch(l){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),j=k.getImageData(e,f,g,h)}catch(l){throw alert("Cannot access local image"),new Error("unable to access local image data: "+l)}}}catch(l){throw alert("Cannot access image"),new Error("unable to access image data: "+l)}var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=j.data,L=i+i+1,M=g-1,N=h-1,O=i+1,P=O*(O+1)/2,Q=new a,R=Q;for(o=1;L>o;o++)if(R=R.next=new a,o==O)var S=R;R.next=Q;var T=null,U=null;s=r=0;var V=c[i],W=d[i];for(n=0;h>n;n++){for(B=C=D=E=t=u=v=w=0,x=O*(F=K[r]),y=O*(G=K[r+1]),z=O*(H=K[r+2]),A=O*(I=K[r+3]),t+=P*F,u+=P*G,v+=P*H,w+=P*I,R=Q,o=0;O>o;o++)R.r=F,R.g=G,R.b=H,R.a=I,R=R.next;for(o=1;O>o;o++)p=r+((o>M?M:o)<<2),t+=(R.r=F=K[p])*(J=O-o),u+=(R.g=G=K[p+1])*J,v+=(R.b=H=K[p+2])*J,w+=(R.a=I=K[p+3])*J,B+=F,C+=G,D+=H,E+=I,R=R.next;for(T=Q,U=S,m=0;g>m;m++)K[r+3]=I=w*V>>W,0!=I?(I=255/I,K[r]=(t*V>>W)*I,K[r+1]=(u*V>>W)*I,K[r+2]=(v*V>>W)*I):K[r]=K[r+1]=K[r+2]=0,t-=x,u-=y,v-=z,w-=A,x-=T.r,y-=T.g,z-=T.b,A-=T.a,p=s+((p=m+i+1)<M?p:M)<<2,B+=T.r=K[p],C+=T.g=K[p+1],D+=T.b=K[p+2],E+=T.a=K[p+3],t+=B,u+=C,v+=D,w+=E,T=T.next,x+=F=U.r,y+=G=U.g,z+=H=U.b,A+=I=U.a,B-=F,C-=G,D-=H,E-=I,U=U.next,r+=4;s+=g}for(m=0;g>m;m++){for(C=D=E=B=u=v=w=t=0,r=m<<2,x=O*(F=K[r]),y=O*(G=K[r+1]),z=O*(H=K[r+2]),A=O*(I=K[r+3]),t+=P*F,u+=P*G,v+=P*H,w+=P*I,R=Q,o=0;O>o;o++)R.r=F,R.g=G,R.b=H,R.a=I,R=R.next;for(q=g,o=1;i>=o;o++)r=q+m<<2,t+=(R.r=F=K[r])*(J=O-o),u+=(R.g=G=K[r+1])*J,v+=(R.b=H=K[r+2])*J,w+=(R.a=I=K[r+3])*J,B+=F,C+=G,D+=H,E+=I,R=R.next,N>o&&(q+=g);for(r=m,T=Q,U=S,n=0;h>n;n++)p=r<<2,K[p+3]=I=w*V>>W,I>0?(I=255/I,K[p]=(t*V>>W)*I,K[p+1]=(u*V>>W)*I,K[p+2]=(v*V>>W)*I):K[p]=K[p+1]=K[p+2]=0,t-=x,u-=y,v-=z,w-=A,x-=T.r,y-=T.g,z-=T.b,A-=T.a,p=m+((p=n+O)<N?p:N)*g<<2,t+=B+=T.r=K[p],u+=C+=T.g=K[p+1],v+=D+=T.b=K[p+2],w+=E+=T.a=K[p+3],T=T.next,x+=F=U.r,y+=G=U.g,z+=H=U.b,A+=I=U.a,B-=F,C-=G,D-=H,E-=I,U=U.next,r+=g}k.putImageData(j,e,f)}}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];AvatarCrop.addFilter("blur",function(a,c){c.getContext("2d");b(c,0,0,c.width,c.height,this.configs.radius)},{radius:5})}(),function(){AvatarCrop.addFilter("greyscale",function(a,b){AvatarCrop.execFilter(b,{desaturate:1})})}(),function(){AvatarCrop.addFilter("negative",function(a,b){for(var c=b.getContext("2d"),d=c.getImageData(0,0,b.width,b.height),e=d.data,f=0;f<e.length;f+=4)e[f]=255-e[f],e[f+1]=255-e[f+1],e[f+2]=255-e[f+2];c.putImageData(d,0,0)})}(),function(){AvatarCrop.addFilter("sepia",function(a,b){AvatarCrop.execFilter(b,{sepia:1})})}(),function(){AvatarCrop.addFilter("vignette",function(a,b){AvatarCrop.execFilter(b,{vignette:this.configs.radius})},{radius:.16})}();
//# sourceMappingURL=avatar-crop.full.min.js.map